(function(){"use strict";var t={148:function(t,e,i){var r=i(144),n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",{staticClass:"menu_btns"},[e("button",{staticClass:"button-13",attrs:{role:"button"},on:{click:t.addRect}},[t._v("Добавить")]),e("button",{staticClass:"button-13",attrs:{role:"button"},on:{click:t.deleteRects}},[t._v(" Очистить ")]),e("button",{staticClass:"button-13",attrs:{role:"button"},on:{click:t.save}},[t._v("Сохранить")]),e("button",{staticClass:"button-13",attrs:{role:"button"},on:{click:t.restore}},[t._v(" Восстановить ")])]),e("v-stage",{ref:"stage",attrs:{config:t.stageSize}},[e("v-layer",{ref:"layer"},[t._l(t.rectsList,(function(i){return e("v-group",{key:i.id,ref:"group",refInFor:!0,attrs:{config:{draggable:!t.isChosed}},on:{dragmove:t.updateCoords}},[e("v-rect",{ref:"rect",refInFor:!0,attrs:{config:{x:i.x,y:i.y,id:i.id,width:100,height:100,stroke:"black",strokeWidth:4}}}),t._l(i.nodes.slice(0,i.activeNodes),(function(r){return e("v-circle",{key:r.id,ref:"circle",refInFor:!0,attrs:{config:{id:r.id,x:i.x+r.x,y:i.y+r.y,radius:10,fill:t.isChosed===r.id?"red":"green",draggable:!1}},on:{click:t.startLine}})}))],2)})),t._l(t.connectors,(function(t){return e("v-line",{key:t.id,attrs:{config:{stroke:"black",strokeWidth:4,points:t.coords}}})}))],2)],1),t._m(0)],1)},o=[function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"menu"}},[e("div",[e("button",{attrs:{id:"oneNode"}},[t._v("1")]),e("button",{attrs:{id:"twoNode"}},[t._v("2")]),e("button",{attrs:{id:"threeNode"}},[t._v("3")]),e("button",{attrs:{id:"fourNode"}},[t._v("4")]),e("button",{attrs:{id:"delete-button"}},[t._v("Delete")])])])}];const s=window.innerWidth,a=window.innerHeight-40;var d={data(){return{rectsList:[],stageSize:{width:s,height:a},isDragging:!1,connectors:[],fromTarget:null,toTarget:null,parentFromId:null,parentToId:null,isChosed:null,updatedRectList:[],toSave:[],gapArr:[]}},methods:{addRect(){let t=Math.random()*s,e=Math.random()*a;this.rectsList.push({id:Date.now()+Math.random(),x:t>=s-150?Math.random()*s:t,y:e>=a-150?Math.random()*a:e,activeNodes:1,nodes:this.getNodes()})},deleteRects(){this.rectsList=[],this.connectors=[]},startLine(t){const e=t.target instanceof Konva.Circle;if(!e)return;const i=this.$refs.stage.getNode();if(this.isChosed){if(this.toTarget=i.getPointerPosition(),this.parentToId=t.target.parent.children[0].attrs.id,this.parentFromId===this.parentToId)return void(this.isChosed=null);const e={coords:[this.fromTarget.x,this.fromTarget.y,this.toTarget.x,this.toTarget.y],id:this.connectors.length,from:this.isChosed,to:t.target.attrs.id,parentFromId:this.parentFromId,parentToId:this.parentToId};this.connectors.push(e),this.fromTarget=null,this.toTarget=null,this.isChosed=null}else this.fromTarget=i.getPointerPosition(),this.isChosed=t.target.attrs.id,this.parentFromId=t.target.parent.children[0].attrs.id},updateObjects(){},updateCoords(t){let e=t.target.children.filter((t=>t instanceof Konva.Circle)),i=t.target.children.filter((t=>t instanceof Konva.Rect))[0],r=this.updatedRectList.filter((t=>t.id===i.attrs.id)).length;if(r)this.updatedRectList=this.updatedRectList.map((t=>t.id===i.attrs.id?{x:i.absolutePosition().x,y:i.absolutePosition().y,id:i.attrs.id}:t));else{let t={x:i.absolutePosition().x,y:i.absolutePosition().y,id:i.attrs.id};this.updatedRectList.push(t)}this.connectors.map((t=>{e.forEach((e=>{t.from===e.attrs.id?t.coords.splice(0,2,e.absolutePosition().x,e.absolutePosition().y):t.to===e.attrs.id&&t.coords.splice(2,2,e.absolutePosition().x,e.absolutePosition().y)}))}))},save(){this.rectsList.length&&(this.toSave=JSON.parse(JSON.stringify(this.rectsList)),this.gapArr=this.toSave.map((t=>{let e=this.updatedRectList.filter((e=>t.id===e.id));return e.length>0?{...t,x:e[0].x,y:e[0].y,id:e[0].id}:t})),localStorage.setItem("storage",JSON.stringify(this.gapArr)),localStorage.setItem("connections",JSON.stringify(this.connectors)))},restore(){let t=localStorage.getItem("storage")||"[]",e=localStorage.getItem("connections")||"[]";this.rectsList=JSON.parse(t),this.connectors=JSON.parse(e)},getNodes(){let t=[{id:Math.round(1e4*Math.random()).toString(),x:51,y:-5,radius:10,fill:"black",draggable:!1},{id:Math.round(1e4*Math.random()).toString(),x:-4,y:51,radius:10,fill:"black",draggable:!1},{id:Math.round(1e4*Math.random()).toString(),x:51,y:105,radius:10,fill:"black",draggable:!1},{id:Math.round(1e4*Math.random()).toString(),x:104,y:51,radius:10,fill:"black",draggable:!1}];return t}},computed:{},mounted(){const t=this.$refs.stage.getNode();var e=document.getElementById("menu");let i,r,n;document.getElementById("delete-button").addEventListener("click",(()=>{this.connectors=this.connectors.filter((t=>t.parentFromId!=r&&t.parentToId!=r)),i.removeChildren(),this.isChosed=null})),document.getElementById("oneNode").addEventListener("click",(()=>{this.rectsList=this.rectsList.map((t=>t.id===n?{...t,activeNodes:1}:t))})),document.getElementById("twoNode").addEventListener("click",(()=>{this.rectsList=this.rectsList.map((t=>t.id===n?{...t,activeNodes:2}:t))})),document.getElementById("threeNode").addEventListener("click",(()=>{this.rectsList=this.rectsList.map((t=>t.id===n?{...t,activeNodes:3}:t))})),document.getElementById("fourNode").addEventListener("click",(()=>{this.rectsList=this.rectsList.map((t=>t.id===n?{...t,activeNodes:4}:t))})),window.addEventListener("click",(()=>{e.style.display="none"})),t.on("contextmenu",(function(o){if(o.evt.preventDefault(),o.target!==t){r=o.target.attrs.id,i=o.target.parent,n=i.children[0].attrs.id,e.style.display="initial";var s=t.container().getBoundingClientRect();e.style.top=s.top+t.getPointerPosition().y+4+"px",e.style.left=s.left+t.getPointerPosition().x+4+"px"}}))}},c=d,l=i(1),u=(0,l.Z)(c,n,o,!1,null,null,null),h=u.exports,f=i(168),g=i.n(f);r["default"].use(g()),r["default"].config.productionTip=!1,new r["default"]({render:t=>t(h)}).$mount("#app")}},e={};function i(r){var n=e[r];if(void 0!==n)return n.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,i),o.exports}i.m=t,function(){var t=[];i.O=function(e,r,n,o){if(!r){var s=1/0;for(l=0;l<t.length;l++){r=t[l][0],n=t[l][1],o=t[l][2];for(var a=!0,d=0;d<r.length;d++)(!1&o||s>=o)&&Object.keys(i.O).every((function(t){return i.O[t](r[d])}))?r.splice(d--,1):(a=!1,o<s&&(s=o));if(a){t.splice(l--,1);var c=n();void 0!==c&&(e=c)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[r,n,o]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,r){var n,o,s=r[0],a=r[1],d=r[2],c=0;if(s.some((function(e){return 0!==t[e]}))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(d)var l=d(i)}for(e&&e(r);c<s.length;c++)o=s[c],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(l)},r=self["webpackChunkcanvas"]=self["webpackChunkcanvas"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=i.O(void 0,[998],(function(){return i(148)}));r=i.O(r)})();
//# sourceMappingURL=app.6ca977c1.js.map